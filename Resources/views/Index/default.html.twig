{% extends bap.layout %}
{% oro_title_set({params : {"%name%": dashboard.getLabel()|trans }}) %}

{% block content %}
<div class="layout-content dashboard-contailer">
    <div class="container-fluid page-title">
        <div class="navigation clearfix navbar-extra navbar-extra-right">
            <div class="row">
                {% block title %}
                <div class="pull-left pull-left-extra">
                    <div class="pull-left">
                        <h1 class="oro-subtitle">{{ dashboard.getLabel()|trans }}</h1>
                    </div>
                </div>
                {% endblock title %}
                {% block titleNavButtons %}
                <div class="pull-right title-buttons-container">
                    {% placeholder dashboard_navButtons_before %}
                    {% block navButtons %}
                        {% if dashboards|length > 1 %}
                        <div class="dashboard-selector-container">
                            <label for="dashboard_selector">{{ 'Dashboards'|trans }}:</label>
                            <select id="dashboard_selector">
                                {% for dashboardModel in dashboards %}
                                    <option value="{{ dashboardModel.dashboard.id }}"{% if dashboardModel.dashboard.id == dashboard.dashboard.id %} selected="selected"{% endif %}>
                                        {{ dashboardModel.getLabel()|trans }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <a href="javascript:void(0);" class="dashboard-widgets-add">Add widget</a>
                        <script type="text/javascript">
                            require(['jquery', 'routing', 'oronavigation/js/navigation'],
                            function($, routing, Navigation){
                                $(function () {
                                    $('#dashboard_selector').on('change', function (e) {
                                        var url = routing.generate('oro_dashboard_index', {id: $(e.currentTarget).val()}) + '?change_dashboard=true',
                                            navigation = Navigation.getInstance();
                                        if (navigation) {
                                            navigation.processRedirect({
                                                fullRedirect: false,
                                                location: url
                                            });
                                        } else {
                                            location.href = url;
                                        }
                                    });
                                });
                            });
                        </script>
                        {% endif %}
                    {% endblock navButtons %}
                    {% placeholder dashboard_navButtons_after %}
                </div>
                {% endblock titleNavButtons %}
            </div>
        </div>
    </div>
    {% block widgets_content %}
        {% set contentClass = contentClass|default('dashboard-container') %}
        <div class="scrollable-container">
            <div class="responsive-section {{ contentClass }}">
                <div class="clearfix">
                {% block widgets %}
                    {{ __.renderColumn(dashboard.getOrderedColumnWidgets(1, false, true), 1) }}
                    {{ __.renderColumn(dashboard.getOrderedColumnWidgets(2, true, false), 2) }}
                {% endblock widgets %}
                </div>
            </div>
        </div>
        <script type="text/html" id="available-dashboard-widgets">
            {% for widget in widgets %}
                <div class="dashboard-widget-container">
                {% if widget.config.thumbnail is defined %}
                    <img class="dashboard-widget-thumbnail" src="{{ widget.config.thumbnail }}" alt="Preview" />
                {% else %}
                    <div class="dashboard-widget-thumbnail"></div>
                {% endif %}
                <p>
                {% if widget.config.label is defined %}
                    <strong class="dashboard-widget-title">{{ widget.config.label|trans }}</strong>
                {% endif %}
                {% if widget.config.description is defined %}
                    <span class="dashboard-widget-description">{{ widget.config.description }}</span>
                    {% else %}
                    <span class="dashboard-widget-description">
                        Lorem ipsum dolor sit amet, fugit movet fastidii ut vim, vel at etiam libris audire,
                        atqui everti quaestio mel cu. Id sit veri nonumy disputando, pri cu tota prima
                        cotidieque. Mea utamur periculis id, ocurreret euripidis in cum, sed alterum platonem
                        ut. Pri latine recusabo ad, an ius virtute ponderum.
                    </span>
                {% endif %}
                </p>
                </div>
            {% endfor %}
        </script>

        <script type="text/javascript">
            require(['jquery', 'orodashboard/js/dashboard-container', 'orodashboard/js/widget-picker'],
            function($, DashboardContainer, WidgetPicker){
                var widgetContainer = new DashboardContainer();
                WidgetPicker.init();
            });
        </script>
    {% endblock widgets_content %}
</div>
{% endblock content %}

{% macro renderColumn(widgets, column) %}
    <div class="responsive-cell column" data-column="{{ column }}">
        {% for widget in widgets %}
            {{
                oro_widget_render({
                    'widgetType': 'dashboard-item',
                    'wid': 'dashboard-widget-' ~ widget.widget.id,
                    'url': path(widget.config.route, widget.config.route_parameters)
                })
            }}
        {% endfor %}
    </div>
{% endmacro %}
{% import _self as __ %}
